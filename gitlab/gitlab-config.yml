apiVersion: v1
kind: ConfigMap
metadata:
    labels:
        k8s-app: gitlab
    name: gitlab-configmap
    namespace: gitlab

data:

  gitlab_omnibus_config: |

    external_url 'https://gitlab.tech.dreamhack.se';
    root_pass = ENV['GITLAB_ROOT_PASSWORD'];
    gitlab_rails['initial_root_password'] = root_pass unless root_pass.to_s == '';
    gitlab_rails['trusted_proxies'] = [ '10.0.0.0/8', '172.16.0.0/16' ]

    nginx['listen_port'] = 80;
    nginx['listen_https'] = false;

    unicorn['worker_processes'] = 2;
    manage_accounts['enable'] = true;
    manage_storage_directories['manage_etc'] = false;

    gitlab_shell['auth_file'] = "/gitlab-data/ssh/authorized_keys";
    git_data_dirs({ "default" => { "path" => "/gitlab-data/git-data" } });
    gitlab_rails['shared_path'] = '/gitlab-data/shared';
    gitlab_rails['uploads_directory'] = '/gitlab-data/uploads';
    gitlab_ci['builds_directory'] = '/gitlab-data/builds';
